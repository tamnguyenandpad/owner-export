(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[124],{1866:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shares/[shareId]/constructions/[constructionId]/reports/[reportId]",function(){return t(4431)}])},2578:function(e,r,t){"use strict";var n=t(2322),i=t(2784),o=function(e){var r=e.fill;return(0,n.jsx)("svg",{width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{d:"M23.71 1.29026C23.575 1.15593 23.4045 1.06293 23.2185 1.02218C23.0325 0.98144 22.8388 0.994649 22.66 1.06026L0.660001 9.06026C0.470269 9.13222 0.306921 9.26021 0.191652 9.42721C0.0763829 9.59422 0.0146484 9.79234 0.0146484 9.99526C0.0146484 10.1982 0.0763829 10.3963 0.191652 10.5633C0.306921 10.7303 0.470269 10.8583 0.660001 10.9303L9.25 14.3603L15.59 8.00026L17 9.41026L10.63 15.7803L14.07 24.3703C14.1441 24.5563 14.2724 24.7159 14.4382 24.8282C14.604 24.9405 14.7997 25.0005 15 25.0003C15.2021 24.9961 15.3982 24.9308 15.5624 24.813C15.7266 24.6952 15.8513 24.5304 15.92 24.3403L23.92 2.34026C23.9881 2.16333 24.0046 1.97069 23.9674 1.78478C23.9302 1.59887 23.8409 1.42737 23.71 1.29026Z",fill:r||"#EF3340"})})};r.Z=(0,i.memo)(o)},5467:function(e,r,t){"use strict";var n=t(2322),i=t(2784),o=function(e){var r=e.message;return(0,n.jsx)("div",{className:"flex justify-center grow items-center text-grey-500",children:r||"\u4f55\u304b\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f"})};r.Z=(0,i.memo)(o)},6651:function(e,r,t){"use strict";var n=t(2322),i=t(2784),o=t(917),l=t(6582),d=i.forwardRef((function(e,r){var t=e.id,d=e.name,s=e.defaultValue,a=e.readonly,u=e.disabled,c=e.placeholder,v=e.onChange,p=e.onBlur,f=e.onEnter,m=e.isDisableEnter,h=e.className,y=e.row,x=(0,i.useCallback)((function(e){"Enter"!==e.code||!f||e.shiftKey||m||(f(),!l.tq&&(0,o.t)())}),[m,f]);return(0,n.jsx)("textarea",{id:t,"data-testid":"input-ref",name:d,defaultValue:s,placeholder:c||"",ref:r,rows:y||1,onChange:v,onBlur:p,onKeyPress:x,readOnly:a||!1,disabled:u||!1,className:h||"bg-white rounded w-full py-2 px-4 text-grey-900 border border-blue-500"})}));r.Z=(0,i.memo)(d)},4431:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return H}});var n=t(8788),i=t(6383),o=t(2228),l=t(930),d=t(4776),s=t.n(d),a=t(2322),u=t(138),c=t(5632),v=t(2784),p=t(7693),f=t(7417),m=t(4823),h=t(5467),y=t(738),x=t(3397),g=t(1169),b=t(9303),w=t(4066),j=t(9328),R=t(9936),I=t(7328),E=t(6670),C=t(2578),N=t(3955),Z=t(6651),D=t(6582),k=function(e){var r=e.handleCreateReply,t=e.handleEditReply,n=e.beforeEditValue,i=e.mode,o=(0,v.useMemo)((function(){return n||""}),[n]),l=(0,N.cI)({defaultValues:{reply:o},mode:"onChange",reValidateMode:"onChange"}),d=l.formState,s=d.isDirty,u=d.isValid,c=l.register,p=l.handleSubmit,f=l.resetField,m=l.watch,h=l.setValue,y=l.getValues;(0,v.useEffect)((function(){h("reply",n||"")}),[n,h]);var x=(0,v.useCallback)((function(e){e.reply&&("edit"!==i&&r&&r(e),"edit"===i&&t&&o!==e.reply&&t(e),f("reply"))}),[o,r,t,i,f]),g=m("reply"),b=(0,v.useMemo)((function(){return g!==o}),[g,o]);return(0,a.jsxs)("div",{className:"flex items-center","data-testid":"report-input",children:[(0,a.jsx)(Z.Z,(0,E.Z)((0,I.Z)({id:"reply"},c("reply",{validate:{edited:function(e){return!(n&&e===n)||"Is Not Change"},required:function(e){return""!==e.trim()||"Is empty"}}})),{name:"reply",placeholder:"\u8fd4\u4fe1\u3092\u5165\u529b",onEnter:D.tq?function(){var e=document.getElementById("reply"),r=y().reply;if(h("reply",r+"\n"),e&&e.selectionStart){var t=e.selectionStart-1,n=y().reply.substr(0,t);h("reply",n)}}:p(x),isDisableEnter:!g||!b,className:"bg-grey-200 rounded-3xl w-full py-2 px-4 text-grey-900 focus:bg-white focus:outline-red-500 resize-none"})),(0,a.jsx)("div",{className:"ml-2 cursor-pointer ".concat((!s||!u||!g||!b)&&"pointer-events-none"),onClick:p(x),children:(0,a.jsx)(C.Z,{fill:s&&u&&g&&b?"#EF3340":"grey"})})]})},L=(0,v.memo)(k);function P(){var e=(0,o.Z)(["\n                    fragment NewReply on ReportOverview {\n                      id\n                      body\n                      type\n                      userID\n                      ownerID\n                      createdAt\n                      updatedAt\n                      user\n                      owner\n                    }\n                  "]);return P=function(){return e},e}var M=function(e){var r=e.replyEditing,t=e.onExitEditMode,n=(0,c.useRouter)(),o=(0,i.Z)((0,R.Ag)(),1)[0],d=(0,p.I)(),s=(0,v.useCallback)((function(e){o({variables:{shareID:(null===d||void 0===d?void 0:d.share.id)||"",constructionID:(null===d||void 0===d?void 0:d.id)||"",reportReplyID:(null===r||void 0===r?void 0:r.id)||"",body:e.reply.trim()},update:function(e,r){var t=r.data;e.modify({id:"ReportReply:".concat(null===t||void 0===t?void 0:t.updateReportReply.id),fields:{body:function(){return null===t||void 0===t?void 0:t.updateReportReply.body},updatedAt:function(){return null===t||void 0===t?void 0:t.updateReportReply.updatedAt}}}),e.modify({id:"ReportOverview:".concat(n.query.reportId),fields:{replies:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=(arguments.length>1?arguments[1]:void 0).readField,i=e.writeFragment({data:null===t||void 0===t?void 0:t.updateReportReply,fragment:(0,u.Ps)(P())});return r.some((function(e){return n("id",e)===(null===t||void 0===t?void 0:t.updateReportReply.id)}))?r:[i].concat((0,l.Z)(r))}}})},onError:function(e){(0,j.d)(e)}}),t()}),[null===d||void 0===d?void 0:d.id,null===d||void 0===d?void 0:d.share.id,o,t,null===r||void 0===r?void 0:r.id,n.query.reportId]);return(0,a.jsx)("div",{"data-testid":"reply-edit",children:r&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"border-b-[1px] border-b-grey-200 mb-2 flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex-none w-[20px]",children:(0,a.jsx)(w.Z,{color:"grey"})}),(0,a.jsxs)("div",{className:"ml-2 grow",children:[(0,a.jsx)("div",{className:"text-xs text-grey-700",children:"\u7de8\u96c6"}),(0,a.jsx)("div",{className:"text-grey-400 break-words",style:{wordBreak:"break-word"},children:r.body})]}),(0,a.jsx)("div",{className:"flex-none w-[20px] cursor-pointer","data-testid":"exit-edit-btn",onClick:t,children:(0,a.jsx)(b.Z,{color:"grey"})})]}),(0,a.jsx)(L,{beforeEditValue:r.body,handleEditReply:s,mode:"edit"})]})})},_=(0,v.memo)(M),q=t(2305),F=t(4057),S=function(){return(0,a.jsxs)("div",{children:[(0,a.jsx)("hr",{className:"my-4 border-t-gray-200"}),(0,a.jsx)("div",{className:"mt-8 flex items-center justify-center text-center text-grey-400",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(F.Z,{width:"48",height:"50",color:"#b3b8bd"})}),(0,a.jsx)("div",{children:"\u8fd4\u4fe1\u306f\u3042\u308a\u307e\u305b\u3093"}),(0,a.jsx)("div",{children:"\u6700\u521d\u306b\u8fd4\u4fe1\u3059\u308b"})]})})]})},V=(0,v.memo)(S),A=t(4082),O=t(9390),B=t(8932),T=t(1187),K=t(3906),X=t(1093);function G(){var e=(0,o.Z)(["\n                    fragment NewReply on ReportOverview {\n                      id\n                      body\n                      type\n                      userID\n                      ownerID\n                      createdAt\n                      updatedAt\n                      user\n                      owner\n                    }\n                  "]);return G=function(){return e},e}var z=function(){var e,r,t,o,d,b,w=(0,c.useRouter)(),I=(0,p.I)(),E=(0,v.useState)(!1),C=E[0],N=E[1],Z=(0,v.useState)(null),D=Z[0],k=Z[1],P=(0,O.X)(),M=(0,T.T)();(0,v.useEffect)((function(){!P([K.P.reportGet,K.P.reportList])&&M.length&&(null===I||void 0===I?void 0:I.share.id)&&(w.push(X.Z.reports(null===I||void 0===I?void 0:I.share.id,null===I||void 0===I?void 0:I.id)),B.Am.error("\u30a2\u30af\u30bb\u30b9\u3059\u308b\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093\u3002"))}),[P,null===I||void 0===I?void 0:I.id,null===I||void 0===I?void 0:I.share.id,M,w]);var F=(0,R.hK)({variables:{shareID:(null===I||void 0===I?void 0:I.share.id)||"",constructionID:(null===I||void 0===I?void 0:I.id)||"",reportID:w.query.reportId},skip:!I,onError:function(e){(0,j.d)(e)}}),S=F.loading,z=F.error,H=F.data,Q=(0,R.M3)({variables:{reportID:w.query.reportId,shareID:(null===I||void 0===I?void 0:I.share.id)||"",constructionID:(null===I||void 0===I?void 0:I.id)||"",offset:0,limit:3},skip:!I||!P([K.P.replyList]),notifyOnNetworkStatusChange:!0,onError:function(e){(0,j.d)(e)}}),J=Q.loading,U=Q.error,W=Q.fetchMore,Y=Q.data,$=(0,i.Z)((0,R.EF)({onError:function(e){(0,j.d)(e)}}),1)[0],ee=(0,v.useCallback)((function(e){$({variables:{shareID:(null===I||void 0===I?void 0:I.share.id)||"",constructionID:(null===I||void 0===I?void 0:I.id)||"",reportID:w.query.reportId,body:e.reply.trim()},refetchQueries:["ListReportReplies"],update:function(e,r){var t=r.data;e.modify({id:"ReportOverview:".concat(w.query.reportId),fields:{replies:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=(arguments.length>1?arguments[1]:void 0).readField,i=e.writeFragment({data:null===t||void 0===t?void 0:t.createReportReply,fragment:(0,u.Ps)(G())});return r.some((function(e){return n("id",e)===(null===t||void 0===t?void 0:t.createReportReply)}))?r:[i].concat((0,l.Z)(r))},responseTotal:function(e){return e+1}}})}})}),[$,null===I||void 0===I?void 0:I.id,null===I||void 0===I?void 0:I.share.id,w.query.reportId]),re=(0,v.useCallback)((function(e){k(e),N(!0)}),[]),te=(0,v.useCallback)((function(){N(!1)}),[]),ne=(0,i.Z)((0,f.G)(),2),ie=ne[0],oe=ne[1],le=oe.selectedImageIndex,de=oe.openModal,se=oe.closeModal;if(S)return(0,a.jsx)(y.Z,{});if(z)return(0,a.jsx)(h.Z,{});var ae=null===H||void 0===H?void 0:H.report;return(0,a.jsxs)("div",{className:"overflow-hidden grow md:px-6 ",children:[(0,a.jsxs)(m.Z,{className:"p-6 h-full w-full flex-grow overflow-y-scroll md:mt-6 hide-scroll bg-white border border-grey-300",children:[ae&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(q.Z,{report:ae,numsReplies:null===Y||void 0===Y||null===(e=Y.listReportReplies)||void 0===e?void 0:e.total,renderReportPhoto:function(){return(0,a.jsx)(g.Z,{photo:ae.photos||[],className:"mt-4",onClickPhoto:function(e){return de({images:ae.photos||[],selectedPhotoId:e.id})}})}}),(0,a.jsx)(A.Z,{selectedItem:le,images:ie.images,isShow:ie.isShow,closeModal:se})]}),Y&&0!==(null===Y||void 0===Y||null===(r=Y.listReportReplies)||void 0===r||null===(t=r.reportReplies)||void 0===t?void 0:t.length)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{className:"my-4 border-t-gray-200"}),(0,a.jsxs)("div",{className:"px-2 md:px-8 pb-20 flex flex-col-reverse",children:[!P([K.P.replyList])&&(0,a.jsx)("div",{className:"text-grey-300 text-center mt-16",children:"\u30a2\u30af\u30bb\u30b9\u3059\u308b\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093\u3002"}),null===Y||void 0===Y||null===(o=Y.listReportReplies)||void 0===o||null===(d=o.reportReplies)||void 0===d?void 0:d.map((function(e,r){return(0,a.jsx)(x.Z,{onEditReply:re,reply:e,showDate:!0},r)})),(null===Y||void 0===Y||null===(b=Y.listReportReplies)||void 0===b?void 0:b.isLast)||J?"":(0,a.jsx)("a",{className:"my-3 text-gray-600 underline underline-offset-2 cursor-pointer hover:text-gray-900",onClick:(0,n.Z)(s().mark((function e(){var r,t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,W({variables:{reportID:w.query.reportId,shareID:null===I||void 0===I?void 0:I.share.id,constructionID:null===I||void 0===I?void 0:I.id,offset:null===Y||void 0===Y||null===(r=Y.listReportReplies)||void 0===r||null===(t=r.reportReplies)||void 0===t?void 0:t.length,limit:6}});case 3:case"end":return e.stop()}}),e)}))),children:"\u3082\u3063\u3068\u8fd4\u4fe1\u3092\u898b\u308b"}),J&&(0,a.jsx)(y.Z,{}),U&&(0,a.jsx)(h.Z,{message:U.message})]})]}):(0,a.jsx)(V,{})]}),(0,a.jsx)("div",{className:"py-3 px-6 w-full bg-white sticky bottom-0 border border-t-0 border-grey-300",children:C?(0,a.jsx)(_,{replyEditing:D,onExitEditMode:te}):P([K.P.replyCreate,K.P.replyList])&&(0,a.jsx)(L,{handleCreateReply:ee})})]})},H=(0,v.memo)(z)},917:function(e,r,t){"use strict";t.d(r,{t:function(){return i}});var n=t(2838),i=function(){(0,n.Z)(document.activeElement,HTMLElement)&&document.activeElement.blur()}}},function(e){e.O(0,[963,235,582,918,305,774,888,179],(function(){return r=1866,e(e.s=r);var r}));var r=e.O();_N_E=r}]);